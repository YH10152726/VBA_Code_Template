Sub ConsolidateSEQNDataAndRemoveRows()
    Dim ws As Worksheet
    Set ws = ActiveSheet
    
    Dim lastRow As Long
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    Dim i As Long
    Dim currentSEQN As Variant
    Dim sumActual As Double
    Dim startRow As Long
    
    i = 2 ' ヘッダーの次の行から開始
    Do While i <= lastRow
        currentSEQN = ws.Cells(i, "A").Value
        sumActual = 0
        startRow = i
        
        ' 同じSEQNをまとめて合計
        Do While ws.Cells(i, "A").Value = currentSEQN And i <= lastRow
            sumActual = sumActual + Val(ws.Cells(i, "P").Value)
            i = i + 1
        Loop
        
        ' 1行目以外の計画固定有人hを消す
        Dim j As Long
        For j = startRow + 1 To i - 1
            ws.Cells(j, "L").ClearContents
        Next j
        
        ' 実績有人hを合計して1行目に記載、他は消す
        ws.Cells(startRow, "P").Value = sumActual
        For j = startRow + 1 To i - 1
            ws.Cells(j, "P").ClearContents
        Next j
    Loop

    ' 再度最終行を取得（データが更新されたため）
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' 下から上へループして、L列とP列が両方空白の行を削除
    For i = lastRow To 2 Step -1
        If IsEmpty(ws.Cells(i, "L").Value) And IsEmpty(ws.Cells(i, "P").Value) Then
            ws.Rows(i).Delete
        End If
    Next i

    MsgBox "集約と不要行削除が完了しました。"
End Sub